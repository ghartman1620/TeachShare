<html lang="en">
<head>
{% load static %}
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<link rel="stylesheet" href={% static 'accounts/dashboard.css'%} type = "text/css">
<meta charset="utf-8">

  <title>Dashboard</title>
<!-- Tab icon -->
<link rel="icon" type="image/png" href="/static/img/icon.png">
</head>


<body>
{% block body %}

<!-- Navbar -->
<nav class="navbar navbar-inverse ">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="/account/dashboard">
        <img src="{% static "accounts/tslogo.png" %}" alt="TSLogo"/>
      </a>
    </div>
  <!-- Search bar -->
    <form class="navbar-form navbar-left nav-searchpad" 
    method="post" action="{% url 'account:dashboard' %}">
    {% csrf_token %}
      <div class="form-group">
        <input type="text" name="search" class="form-control" placeholder="Search">
      </div>
      <button type="submit" class="btn btn-default">Submit</button>
    </form>
  <!-- Create a Post Button -->
    <ul class="nav navbar-nav nav-navitems">
      <li><a href="/account/create/">
        <p>New Post <span class="glyphicon glyphicon-plus-sign"></span> </p>
        </a>
      </li>
    </ul>
  <!-- Dropdown Account Menu -->
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" >
          <img src="{% static "accounts/applelogo.png" %}" alt="TSLogo"/>
        <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/account/profile/">Profile</a></li>
          <li><a href="/account/profile/edit/">Settings</a></li>
          <li><a href="/account/logout">Log Out</a></li>
        </ul>
      </li>
    </ul>
  </div>
</nav> <!-- ./End Navbar -->


{% if posts %}
	{% for post in posts %}
		<div class="container">
			<h2>{{post.title}} <small>{{post.user}}</small></h2>
			<div class="well">
				<p>
					{{post.content}}
					<a href= '/account/detail/{{post.id}}'>See more</a>
				</p>
			</div>
			<h4><small>Posted {{post.timestamp}} Updated {{post.updated}}
			</small></h4>
			
			<!-- {# This is all to show a "Unlike" button if the user has already liked a post
			and a "Like" button if a user hasn't like that post. The "Like" form is repeated}
			twice becuase we must guard against likedPosts being empty. #}
			{% if likedPosts %}
				{% if post.id in likedPosts %}
				<form action="{% url 'account:like' id=post.id %}" method="POST"
						id="unlikeForm{{post.id}}">
					{% csrf_token %}
					<button type="submit" class="btn btn-default">
						<div id="likeSubmit{{post.id}}">
							Unlike
						</div>
					</button>
				</form>
				{% else %}
				<form action="{% url 'account:like' id=post.id %}" method="POST"
						id="likeForm{{post.id}}">
					{% csrf_token %}
					<button type="submit" class="btn btn-default">
						<div id="likeSubmit{{post.id}}">
							Like
						</div>
					</button>
				</form>
				{% endif %}
			{% else %}
			<form action="{% url 'account:like' id=post.id %}" method="POST"
						id="likeForm{{post.id}}">
				{% csrf_token %}
				<button type="submit" class="btn btn-default">
					<div id="likeSubmit{{post.id}}">
						Like
					</div>
				</button>
			</form>
			{% endif %}-->
			<form action="{% url 'account:like' id=post.id %}" method="POST"
						id="likeForm{{post.id}}">
					{% csrf_token %}
					<button type="submit" class="btn btn-default">
						{% if likedPosts %}
							{% if post.id in likedPosts %}
								<div id="likeSubmit{{post.id}}">Unlike</div>
							{% else %}
								<div id="likeSubmit{{post.id}}">Like</div>
							{% endif %}
						{% else %}
							<div id="likeSubmit{{post.id}}">Like</div>
						{% endif %}
					</button>
				</form>
			<p> Likes: <div id="likes{{post.id}}">{{post.likes}}</div></p>
		</div> <!-- container -->
	{% endfor %}
{% endif %}

<div id="debugtxt"></div>

{% endblock %}

<script>
$("form").submit(function(event) {
	// Stop form from submitting normally
	event.preventDefault();
	var likeReq = $(this);
	var posting = $.post( likeReq.attr('action'), likeReq.serialize() );

	var formId = $(this).closest("form").attr('id');
	var id = formId.substr(8);
	var likeBtnId = "likeSubmit".concat(id);
	document.getElementById("debugtxt").innerHTML = "139";
	
	
	if(document.getElementById(likeBtnId).innerHTML.localeCompare("Like")==0){
		document.getElementById(likeBtnId).innerHTML = "Unlike";
		
		
		var likes = parseInt(document.getElementById("likes".concat(id)).innerHTML);
		
		
		likes++;
		document.getElementById("debugtxt").innerHTML = likes;
		document.getElementById("likes".concat(id)).innerHTML = likes;
	}
	else{
		document.getElementById(likeBtnId).innerHTML = "Like";
		var likes = parseInt(document.getElementById("likes".concat(id)).innerHTML);
		likes--;
		document.getElementById("likes".concat(id)).innerHTML = likes.toString();
	}
	// Send the data using post

	//this will change the text on one like button to unlike

	//substring paramter is simply the index 
	// of the numbers in the string "postLike####" 
	/*
	Plan: One form, no ifs for form in here. A single post request "like" will
	check whtehr a user has liked a post or not and switch that, modifying the post
	score accordingly. This function will only update the plaintext fields on this
	page and send the post request. the post request manages like vs. dislike.
	*/

});


</script>
</body>
